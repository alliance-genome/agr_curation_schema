id: https://github.com/alliance-genome/agr_persistent_schema/src/schema/expression.yaml

imports:
  - affectedGenomicModel
  - allele
  - reagent
  - core
  - gene
  - image
  - linkml:types
  - ontologyTerm
  - phenotypeAndDiseaseAnnotation
  - reference

prefixes:
  alliance: 'http://alliancegenome.org/'
  linkml: 'https://w3id.org/linkml/'
  gff: 'https://w3id.org/gff'
  faldo: 'http://biohackathon.org/resource/faldo#'
  biolink: 'https://w3id.org/biolink/vocab/'
  NLMID: 'https://www.ncbi.nlm.nih.gov/nlmcatalog/?term='
  schema: 'http://schema.org/'
  dct: 'http://purl.org/dc/terms/'
  WIKIDATA_PROPERTY: 'https://www.wikidata.org/wiki/Property:'
  obograph: 'https://github.com/biodatamodels/obograph'

default_prefix: alliance
default_range: string

default_curi_maps:
  - obo_context
  - idot_context
  - semweb_context
  - monarch_context

emit_prefixes:
  - rdf
  - rdfs
  - xsd
  - owl


classes:

  ExpressionExperiment:
    is_a: AuditedObject
    description: >-
      Defined by the entity_assayed (usually a gene), the specimen, the assay,
      the reagents (Antibody, Probe), the conditions, and the reference.
      It groups ExpressionAnnotations; it may have its own notes.
    notes: >-
      Specimens are defined by their AGM and/or alleles (or gel lane at MGI).
      This entity is specific to WB and MGI.
      There are many slots that overlap ExpressionExperiment and
      ExpressionAnnotation; this is intentional, in case we choose to allow MODs
      to submit ExpressionAnnotations without ExpressionExperiments.
      If we require all MODs to submit ExpressionExperiments, this model will
      have to allow for the submission of minimal information.
    slots:
      - curie
      - unique_id
      - mod_entity_id
      - mod_internal_id
      - data_provider
      - single_reference
      - entity_assayed
      - assay_used
      - reagents_used
      - specimen_genomic_model
      - specimen_alleles
      - condition_relations
      - related_notes
    slot_usage:
      # QUESTION: What types of notes do curators want to have for a specific
      #           expression annotation? OK to have them at the level of the
      #           ExpressionAnnotation if we have the correct types?
      related_notes:
        description: >-
          Use different note types to add extra information about specific
          aspects of the ExpressionAnnotation: temporal, structure, substructure,
          cellular_component, annotation-level, etc. Appropriate VocabularyTerms
          will need to be created: expression_annotation_note, etc.
          Slot is inherited from Annotation class.

  ExpressionAnnotation:
    # QUESTION: Inherit from SingleReferenceAssociation instead? Assess the
    #           need for these Annotation class-specific slots: curie,
    #           unique_id, mod_entity_id, mod_internal_id,
    #           condition_relations, related_notes, data_provider.
    is_a: Annotation
    description: >-
      An annotation asserting an association between some entity and an
      expression pattern, supported by a single reference.
    notes: >-
      A mapping of the agr_schemas (FMS) model to this LinkML model is below.
      geneId:                                                    subject
      evidence:                                                  single_reference
      assay:                                                     assay_used
      crossReference:                                            data_provider.cross_reference
      dateAssigned:                                              date_created
      whenExpressed.stageName:                                   n/a
      whenExpressed.stageTermId:                                 object (ExpressionPattern.TemporalContext.developmental_stage_start)
      whenExpressed.stageUberonSlimTerm:                         object (ExpressionPattern.TemporalContext.stage_uberon_slim_terms)
      whereExpressed.anatomicalStructureTermId:                  object (ExpressionPattern.AnatomicalSite.anatomical_structure)
      whereExpressed.anatomicalStructureQualifierTermId:         object (ExpressionPattern.AnatomicalSite.anatomical_structure_qualifiers)
      whereExpressed.anatomicalStructureUberonSlimTermIds:       object (ExpressionPattern.AnatomicalSite.anatomical_structure_uberon_terms)
      whereExpressed.anatomicalSubStructureTermId:               object (ExpressionPattern.AnatomicalSite.anatomical_substructure)
      whereExpressed.anatomicalSubStructureQualifierTermId:      object (ExpressionPattern.AnatomicalSite.anatomical_substructure_qualifiers)
      whereExpressed.anatomicalSubStructureUberonSlimTermIds:    object (ExpressionPattern.AnatomicalSite.anatomical_substructure_uberon_terms)
      whereExpressed.cellularComponentTermId.cellular_component: object (ExpressionPattern.AnatomicalSite.cellular_component)
      whereExpressed.cellularComponentQualifierTermId:           object (ExpressionPattern.AnatomicalSite.cellular_component_qualifiers)
      whereExpressed.whereExpressedStatement:                    where_expressed_statement
      New required slots: relation
      Slots not represented in agr_schemas FMS submission (not required):
        Inherited: curie, unique_id, mod_entity_id, mod_internal_id,
                   condition_relations, related_notes.
        Specified here: reagents_used, specimen_genomic_model, specimen_alleles,
                        expression_qualifiers, negated, uncertain,
                        associated_with_figures,
                        expression_annotation_image_associations.
      Slots common to both ExpressionAnnotation and ExpressionExperiment:
    slots:
      - assay_used
      # QUESTION: have dedicated slot for WhereExpressedStatement, or submit
      #           under related_notes slot?
      - where_expressed_statement
      - belongs_to_expression_experiment
      - reagents_used
      - specimen_genomic_model
      - specimen_alleles
      - expression_qualifiers
      - negated
      - uncertain
      - associated_with_figures
      - expression_annotation_image_associations
    slot_usage:
      # QUESTION: Set range to BiologicalEntity, or keep restricted to Gene?
      subject:
        description: >-
          The entity for which an expression pattern is being described. This
          will be limited to a Gene initially, and expanded to other entity
          types as needed. If the exact subject is not known we may require
          a placeholder (e.g., unknown epitope recognized by the antibody).
          Slot is inherited from Annotation class.
        required: true
        range: Gene
      # QUESTION: Create expressed_in VocabularyTerm?
      relation:
        description: >-
          The relationship type between the subject and the expression pattern.
          Limited to expressed_in for now, but we could choose an alternate
          string or allow for a range of VocabularyTerm.
          Slot is inherited from Annotation class.
        required: true
        range: VocabularyTerm
      # QUESTION: Do we agree that the object of this annotation's assertion is
      #           an ExpressionPattern (i.e., all spatiotemporal attributes)?
      object:
        description: >-
          The spatiotemporal expression pattern of the subject, with associated
          notes.
          Slot is inherited from Annotation class.
        required: true
        range: ExpressionPattern
      single_reference:
        description: >-
          Slot is inherited from Annotation class.
      curie:
        description: >-
          The Alliance-minted ID for the ExpressionAnnotation.
          Slot is inherited from Annotation class.
      unique_id:
        description: >-
          Unique identifier for the ExpressionAnnotation. Will be generated at
          AGR if not submitted by the model organism database.
          Slot is inherited from Annotation class.
      mod_entity_id:
        description: >-
          The model organism database identifier/curie for the
          ExpressionAnnotation.
          Slot is inherited from Annotation class.
      mod_internal_id:
        description: >-
          The model organism database internal identifier for the
          ExpressionAnnotation.
          Slot is inherited from Annotation class.
      # QUESTION: What types of notes do curators want to have for a specific
      #           expression annotation? OK to have them at the level of the
      #           ExpressionAnnotation if we have the correct types?
      related_notes:
        description: >-
          Use different note types to add extra information about specific
          aspects of the ExpressionAnnotation: temporal, structure, substructure,
          cellular_component, annotation-level, etc. Appropriate VocabularyTerms
          will need to be created: expression_annotation_note, etc.
          Slot is inherited from Annotation class.
      data_provider:
        description: >-
          Provide information about the data provider; this slot also allows
          for cross-references to be reported for the annotation.
          Slot is inherited from Annotation class.
      associated_with_figures:
        description: >-
          The figure(s) that support(s) the expression annotation.
        notes: >-
          This can seem redundant with ExpressionAnnotationImagePane, but
          sometimes we know the figure but don't have the image file.
          Optional, as existing annotations from some MODs have no related
          images or figures.
        required: false
        multivalued: true

  # QUESTION: Each FMS expression annotation is limited to one stage. However,
  #           in the LinkML model, it's possible to specify a range.
  #           For initial submission of FMS expression data to the
  #           persistent store, would it make sense to keep limiting each
  #           expression annotation to a single stage to reduce downstream
  #           work on Alliance database and web side? This would defer work
  #           required to infer expression stages between the range limits.
  ExpressionPattern:
    is_a: AuditedObject
    description: >-
      An expression pattern, as defined by spatial and temporal attributes,
      including all qualifiers.
    slots:
      - when_expressed
      - where_expressed

  TemporalContext:
    is_a: AuditedObject
    description: >-
      The developmental stage and/or age of the specimen in an annotation. The
      developmental_stage_stop slot is optional.
    slots:
      - developmental_stage_start
      - developmental_stage_stop
      - age
      - temporal_qualifiers
      - stage_uberon_slim_terms

  AnatomicalSite:
    is_a: AuditedObject
    description: >-
      The set of terms that define a specific anatomical site within a specimen.
    slots:
      - anatomical_structure
      - anatomical_structure_qualifiers
      - anatomical_structure_uberon_terms
      - anatomical_substructure
      - anatomical_substructure_qualifiers
      - anatomical_substructure_uberon_terms
      - cellular_component
      - cellular_component_qualifiers
    rules:
      - postconditions:
          any_of:
            - slot_conditions:
                anatomical_structure:
                  required: true
            - slot_conditions:
                cellular_component:
                  required: true
          description: At least one of anatomical_structure or cellular_component should be populated.

  # QUESTION: Is evidence required? If not, make this a child of Association.
  ExpressionAnnotationImagePaneAssociation:
    is_a: Association
    description: >-
      An association between an ExpressionAnnotation and an image (in part or
      in full).
    notes: >-
      This aims to provide the same functionality as MGI imagepane.
      Some MODs (like ZFIN) point to the whole image. In these cases,
      the pane would encompass the whole image.
    slot_usage:
      subject:
        range: ExpressionAnnotation
      object:
        range: ImagePane

slots:

  age:
    description: >-
      The age at which an annotated event was observed.
    domain: TemporalContext
    range: string
    multivalued: false

  anatomical_substructure:
    domain: AnatomicalSite
    range: AnatomicalTerm
    multivalued: false

  # QUESTION: Should the range be OntologyTerm, VocabularyTerm, or other?
  #           Many qualifiers map to BSPO, others do not (have FBcv ID).
  # QUESTION: Should we limit this to one qualifier?
  anatomical_substructure_qualifiers:
    notes: >-
      See the spatial_qualifier_set enum at the bottom of this file for terms.
    domain: AnatomicalSite
    range: VocabularyTerm
    multivalued: true

  # QUESTION: Allow for submission of Other if no UBERONTerm applies?
  anatomical_substructure_uberon_terms:
    notes: >-
      Allowable terms: UBERON:0001009, UBERON:0005409, UBERON:0000949,
                       UBERON:0001008, UBERON:0002330, UBERON:0002193,
                       UBERON:0002416, UBERON:0002423, UBERON:0002204,
                       UBERON:0001016, UBERON:0000990, UBERON:0001004,
                       UBERON:0001032, UBERON:0005726, UBERON:0007037,
                       UBERON:0002105, UBERON:0002104, UBERON:0000924,
                       UBERON:0000925, UBERON:0000926, UBERON:0003104,
                       UBERON:0001013, UBERON:0000026, UBERON:0016887,
                       UBERON:6005023, UBERON:0002539, Other
      This was a required field in the FMS submission, but if no UBERONTerm
      applied, the word Other was used.
    domain: AnatomicalSite
    range: UBERONTerm
    multivalued: true

  anatomical_structure:
    domain: AnatomicalSite
    range: AnatomicalTerm
    multivalued: false

  # QUESTION: Should the range be OntologyTerm, VocabularyTerm, or other?
  #           Many qualifiers map to BSPO, others do not (have FBcv ID).
  # QUESTION: Should we limit this to one qualifier?
  anatomical_structure_qualifiers:
    notes: >-
      See the spatial_qualifier_set enum at the bottom of this file for terms.
    domain: AnatomicalSite
    range: VocabularyTerm
    multivalued: true

  # QUESTION: Allow for submission of Other if no UBERONTerm applies?
  anatomical_structure_uberon_terms:
    notes: >-
      Allowable terms: UBERON:0001009, UBERON:0005409, UBERON:0000949,
                       UBERON:0001008, UBERON:0002330, UBERON:0002193,
                       UBERON:0002416, UBERON:0002423, UBERON:0002204,
                       UBERON:0001016, UBERON:0000990, UBERON:0001004,
                       UBERON:0001032, UBERON:0005726, UBERON:0007037,
                       UBERON:0002105, UBERON:0002104, UBERON:0000924,
                       UBERON:0000925, UBERON:0000926, UBERON:0003104,
                       UBERON:0001013, UBERON:0000026, UBERON:0016887,
                       UBERON:6005023, UBERON:0002539, Other
      This was a required field in the FMS submission, but if no UBERONTerm
      applied, the word Other was used.
    domain: AnatomicalSite
    range: UBERONTerm
    multivalued: true

  assay_used:
    description: >-
      The assay used to experimentally determine gene expression.
    domain: ExpressionAnnotation
    range: MMOTerm

  belongs_to_expression_experiment:
    description: >-
      Holds between an ExpressionAnnotation and an ExpressionExperiment.
    domain: ExpressionAnnotation
    range: ExpressionExperiment
    required: false
    multivalued: false

  cellular_component:
    notes: >-
      I would like to restrict the range to GOTerm in cellular_component
      branch, but I'm not sure how to do this.
    domain: AnatomicalSite
    range: GOTerm

  # QUESTION: Should the range be OntologyTerm, VocabularyTerm, or other?
  # QUESTION: Should we limit this to one qualifier?
  # QUESTION: Do we have a list of applicable qualifiers?
  cellular_component_qualifiers:
    domain: AnatomicalSite
    range: VocabularyTerm
    multivalued: true

  developmental_stage_start:
    description: >-
      The beginning developmental stage at which an annotated event was observed.
    notes: >-
      Currently, we limit this to a single stage, but we could consider allowing
      for stage ranges for a single annotation.
    domain: TemporalContext
    range: StageTerm
    multivalued: false
    required: true

  developmental_stage_stop:
    description: >-
      The end developmental stage at which an annotated event was observed.
      This is not required if the annotation applies to a single stage.
    notes: >-
      Currently, we limit this to a single stage, but we could consider allowing
      for stage ranges for a single annotation.
    domain: TemporalContext
    range: StageTerm
    multivalued: false
    required: false

  # QUESTION: Set range to BiologicalEntity, or keep restricted to Gene?
  entity_assayed:
    description: >-
      The subject of the ExpressionExperiment. This will be limited to a Gene
      initially, and expanded to other entity types as needed. If the exact
      subject is not known we may require a placeholder (e.g., unknown epitope
      recognized by the antibody).
    domain: ExpressionExperiment
    range: Gene
    required: true
    multivalued: false

  expression_annotation_image_associations:
    domain: ExpressionAnnotation
    range: ExpressionAnnotationImagePaneAssociation
    multivalued: true

  # QUESTION: Should the range be OntologyTerm, VocabularyTerm, or other?
  expression_qualifiers:
    description: >-
      Qualifiers that describe additional characteristics of gene expression.
      For example: aint, intense, restricted.
    notes: >-
      See the expression_qualifier_set enum at the bottom of this file for terms.
    domain: ExpressionAnnotation
    range: VocabularyTerm
    multivalued: true

  # QUESTION: Limit to a single reagent? Are >1 reagents ever annotated?
  reagents_used:
    description: >-
      Reagents used in the expression assay: e.g., antibodies, probes.
    domain: ExpressionAnnotation
    range: Reagent
    multivalued: true

  # QUESTION: I think only FB would use this?
  #           The intent is to allow for capture of transgenic reporters that
  #           may not qualify as a Reagent (e.g., enhancer trap). But maybe
  #           there is a better way to capture this info.
  specimen_alleles:
    description: >-
      The Allele(s) of the specimen assayed.
    domain: ExpressionAnnotation
    range: Allele
    multivalued: true

  specimen_genomic_model:
    description: >-
      The AffectedGenomicModel of the specimen assayed.
    domain: ExpressionAnnotation
    range: AffectedGenomicModel
    multivalued: false

  # QUESTION: Set range to OntologyTerm?
  temporal_qualifiers:
    description: >-
      Qualifiers of the stage or age in an annotation.
    notes: >-
      See the temporal_qualifier_set enum at the bottom of this file for terms.
    domain: TemporalContext
    range: VocabularyTerm

  # QUESTION: Set range to VocabularyTerm due to UBERONTerm limitations?
  stage_uberon_slim_terms:
    description: >-
      The high-level UBERON slim terms that apply to the developmental range
      of the TemporalContext component of an ExpressionPattern. The following
      UBERON terms are allowed: UBERON:0000068, UBERON:0000113, "post embryonic, pre-adult".
    notes: >-
      FMS submission allowed for a string due to absence of appropriate UBERON
      term. This term must, for example, cover Drosophila larval and pupal
      stages (there are UBERON terms for each, but not a single term spanning
      both developmental phases).
    domain: TemporalContext
    range: UBERONTerm
    multivalued: true

  when_expressed:
    description: >-
      When some entity is observed to be present in a specimen. If no temporal
      information is available for an annotation, use a root stage term for the
      developmental_stage_start.
    domain: ExpressionPattern
    range: TemporalContext
    multivalued: false
    required: true

  where_expressed:
    description: >-
      Where some entity is observed to be present in a specimen. If no spatial
      information is available for an annotation, use a root anatomical term
      for the anatomical_structure.
    domain: ExpressionPattern
    range: AnatomicalSite
    multivalued: false
    required: true

  where_expressed_statement:
    is_a: related_note
    description: >-
      A human-readable free-text description of the anatomical location of the
      expression pattern.
    domain: ExpressionAnnotation
    range: Note
    required: true
    multivalued: false

enums:

  spatial_qualifier_set:
    notes: >-
      We need to get a set of relevant qualifiers used across the MODs.
      We may prefer to use ontology terms instead of an enum here.
      Filled in with a small sample of FB qualifiers for now.
      Seems like MGI has similar terms
      ZFIN does this.
    permissible_values:
      anterior:
      anterior_posterior_gradient:
      apical:
      basal:
      central:
      distal:
      dorsal:
      dorso-lateral:
      egg_length:
      gap_expression_pattern:
      pair_rule_expression_pattern:
      segment_polarity_expression_pattern:
      terminal_expression_pattern:
      gradient:

  expression_qualifier_set:
    notes: >-
      We need to get a set of relevant qualifiers used across the MODs.
      Filled in with FB qualifiers for now.
    permissible_values:
      strong:
      moderate:
      faint:
      endogenous:
      granular:
      intense:
      punctate:
      uniform:
      non-uniform:
      variable:
      clusters:
      diffuse:
      graded:
      not_specified:
      patchy:
      regionally_restricted:
      scattered:
      single_cells:
      spotted:
      ubiquitous:
      widespread:

  temporal_qualifier_set:
    notes: >-
      We need to get a set of relevant qualifiers used across the MODs.
      Filled in with a FB qualifier for now. MGI, WB, ZFIN don't use this.
    permissible_values:
      throughout:
        description: >-
          An event that happens from start to end times included in the annotation
      sometime_during:
        description: >-
          An event that happens during some of the stages included in the annotation, but maybe not all
