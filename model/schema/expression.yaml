id: https://github.com/alliance-genome/agr_persistent_schema/src/schema/expression.yaml

imports:
  - affectedGenomicModel
  - allele
  - reagent
  - core
  - gene
  - image
  - linkml:types
  - ontologyTerm
  - phenotypeAndDiseaseAnnotation
  - reference

prefixes:
  alliance: 'http://alliancegenome.org/'
  linkml: 'https://w3id.org/linkml/'
  gff: 'https://w3id.org/gff'
  faldo: 'http://biohackathon.org/resource/faldo#'
  biolink: 'https://w3id.org/biolink/vocab/'
  NLMID: 'https://www.ncbi.nlm.nih.gov/nlmcatalog/?term='
  schema: 'http://schema.org/'
  dct: 'http://purl.org/dc/terms/'
  WIKIDATA_PROPERTY: 'https://www.wikidata.org/wiki/Property:'
  obograph: 'https://github.com/biodatamodels/obograph'

default_prefix: alliance
default_range: string

default_curi_maps:
  - obo_context
  - idot_context
  - semweb_context
  - monarch_context

emit_prefixes:
  - rdf
  - rdfs
  - xsd
  - owl


classes:

  ExpressionExperiment:
    is_a: AuditedObject
    abstract: true
    description: >-
      The experimental design used to determine the expression of some entity,
      defined by the entity_assayed, the specimen, the assay, the reagents
      (e.g., Antibody, Probe), the environmental conditions, and the reference.
      It groups ExpressionAnnotations; it may have its own notes.
    notes: >-
      Specimens are defined by their AGM (or gel lane at MGI).
      This entity is originally specific to WB and MGI.
    slots:
      - curie
      - unique_id
      - mod_entity_id
      - mod_internal_id
      - data_provider
      - single_reference
      - entity_assayed
      - assay_used
      - detection_reagents
      - specimen_genomic_model
      - specimen_alleles
      - condition_relations
      - related_notes
      - expression_annotations    # For non-DTO only; for data submission, relate via ExpressionAnnotationDTO.from_expression_experiment instead.

  # DQM NOTE: For submission of the FMS expression data, one will need to also
  #           submit ExpressionExperiment objects that group the annotations
  #           based on these slots: single_reference, entity_assayed, assay_used,
  #           specimen_genomic_model, condition_relations.
  #           I believe we're limiting FMS data to just expression in "wildtype"
  #           under normal conditions. This will be expanded at some point.
  GeneExpressionExperiment:
    is_a: ExpressionExperiment
    description: >-
      An ExpressionExperiment for a Gene.
    slot_usage:
      entity_assayed:
        description: >-
          The Gene that is assayed in an ExpressionExperiment.
        range: Gene
      mod_internal_id:
        description: >-
          The MOD internal identifier for an expression experiment, if no curie
          is available. Can be constructed at the MOD just for submission.


  # DQM NOTE: The assay (MMOTerm) is now submitted for the ExpressionExperiment object instead.
  # DQM NOTE: Must now submit a relation slot value (is_expressed_in) for each ExpressionAnnotation.
  ExpressionAnnotation:
    is_a: Annotation
    abstract: true
    description: >-
      An annotation asserting an association between some entity and an
      expression pattern, supported by a single reference. Uniquely identifying
      aspects of this object comprise all slots (possibly excepting figure and
      image information).
    notes: >-
      A mapping of the agr_schemas (FMS) model to this LinkML model:
      geneId:                                                    ExpressionAnnotation.subject
      evidence:                                                  ExpressionAnnotation.single_reference
      assay:                                                     ExpressionExperiment.assay_used
      crossReference:                                            ExpressionAnnotation.data_provider.cross_reference
      dateAssigned:                                              ExpressionAnnotation.date_created
      whenExpressed.stageName:                                   ExpressionAnnotation.when_expressed_stage_name
      whenExpressed.stageTermId:                                 ExpressionAnnotation.object (ExpressionPattern.TemporalContext.developmental_stage_start)
      whenExpressed.stageUberonSlimTerm:                         ExpressionAnnotation.object (ExpressionPattern.TemporalContext.stage_uberon_slim_terms)
      whereExpressed.anatomicalStructureTermId:                  ExpressionAnnotation.object (ExpressionPattern.AnatomicalSite.anatomical_structure)
      whereExpressed.anatomicalStructureQualifierTermId:         ExpressionAnnotation.object (ExpressionPattern.AnatomicalSite.anatomical_structure_qualifiers)
      whereExpressed.anatomicalStructureUberonSlimTermIds:       ExpressionAnnotation.object (ExpressionPattern.AnatomicalSite.anatomical_structure_uberon_terms)
      whereExpressed.anatomicalSubStructureTermId:               ExpressionAnnotation.object (ExpressionPattern.AnatomicalSite.anatomical_substructure)
      whereExpressed.anatomicalSubStructureQualifierTermId:      ExpressionAnnotation.object (ExpressionPattern.AnatomicalSite.anatomical_substructure_qualifiers)
      whereExpressed.anatomicalSubStructureUberonSlimTermIds:    ExpressionAnnotation.object (ExpressionPattern.AnatomicalSite.anatomical_substructure_uberon_terms)
      whereExpressed.cellularComponentTermId.cellular_component: ExpressionAnnotation.object (ExpressionPattern.AnatomicalSite.cellular_component)
      whereExpressed.cellularComponentQualifierTermId:           ExpressionAnnotation.object (ExpressionPattern.AnatomicalSite.cellular_component_qualifiers)
      whereExpressed.whereExpressedStatement:                    ExpressionAnnotation.where_expressed_statement
      New required slots: relations.
      New slots not required for submission of original FMS data: curie,
      unique_id, mod_entity_id, mod_internal_id, related_notes,
      expression_qualifiers, negated, uncertain, associated_with_figures,
      expression_annotation_image_associations, condition_relations.
    slots:
      # from_expression_experiment   # For DTO only; for database, relate via non-DTO ExpressionExperiment.expression_annotations instead.
      - where_expressed_statement
      - negated
      - uncertain
      - associated_with_figures
      - expression_annotation_image_associations
    slot_usage:
      subject:
        description: >-
          The entity for which an expression pattern is being described; the
          exact type will be constrained by the type of ExpressionAnnotation.
        notes: >-
          Slot is inherited from Annotation class.
        required: true
      relation:
        description: >-
          The relationship type between the subject and the expression pattern.
          The exact relation will be constrained by the type of
          ExpressionAnnotation.
        notes: >-
          Slot is inherited from Annotation class.
        required: true
        range: VocabularyTerm
      object:
        description: >-
          The spatiotemporal expression pattern of the subject, with associated
          notes.
        notes: >-
          Slot is inherited from Annotation class.
        required: true
        range: ExpressionPattern
      # FUTURE ACTION ITEM: Accommodate WB annotations with non-Reference evidence.
      single_reference:
        description: >-
          The single Reference that supports the ExpressionAnnotation.
        notes: >-
          Will not be editable in the curation interface.
          Slot is inherited from Annotation class.
        required: true
        range: Reference
      curie:
        description: >-
          The Alliance-minted ID for the ExpressionAnnotation.
        notes: >-
          Slot is inherited from Annotation class.
      unique_id:
        description: >-
          Unique identifier for the ExpressionAnnotation. Will be generated at
          AGR if not submitted by the model organism database.
        notes: >-
          Slot is inherited from Annotation class.
      mod_entity_id:
        description: >-
          The model organism database identifier/curie for the
          ExpressionAnnotation.
        notes: >-
          Slot is inherited from Annotation class.
      mod_internal_id:
        description: >-
          The model organism database internal identifier for the
          ExpressionAnnotation.
        notes: >-
          Slot is inherited from Annotation class.
      data_provider:
        description: >-
          Provide information about the data provider; this slot also allows
          for cross-references to be reported for the annotation.
        notes: >-
          Slot is inherited from Annotation class.
      # FUTURE ACTION ITEM: Enumerate note types for this annotation level (xprn WG).
      # FUTURE ACTION ITEM: Is it better to have ExpressionAnnotation-level notes of
      #                     various types, or, add related_notes slots to specific
      #                     parts like AnatomicalSite, TemporalContext, etc?
      related_notes:
        description: >-
          Use different note types to add extra information about specific
          aspects of the ExpressionAnnotation: temporal, structure, substructure,
          cellular_component, annotation-level, etc. Appropriate VocabularyTerms
          will need to be created: expression_annotation_note, etc.
        notes: >-
          Slot is inherited from Annotation class.
      associated_with_figures:
        description: >-
          The figure(s) that support(s) the expression annotation.
        notes: >-
          This can seem redundant with ExpressionAnnotationImagePane, but
          sometimes we know the figure but don't have the image file.
          Optional, as existing annotations from some MODs have no related
          images or figures.
        required: false
      expression_annotation_image_associations:
        description: >-
          Images for the ExpressionAnnotation.
        required: false

  GeneExpressionAnnotation:
    is_a: ExpressionAnnotation
    description: >-
      An annotation describing an expression pattern for a gene.
    slot_usage:
      subject:
        description: >-
          The gene to which the expression annotation applies.
        range: Gene
      # ACTION ITEM: Create is_expressed_in VocabularyTerm (Daniela).
      relation:
        description: >-
          For a gene, the relation should be constrained to the expresssed_in
          VocabularyTerm.

  # DQM NOTE: Each FMS expression annotation is limited to one stage. However,
  #           in the LinkML model, it's possible to specify a range.
  ExpressionPattern:
    is_a: AuditedObject
    description: >-
      An expression pattern, as defined by spatial and temporal attributes,
      including all qualifiers.
    slots:
      - when_expressed
      - where_expressed

  TemporalContext:
    is_a: AuditedObject
    description: >-
      The developmental stage and/or age of the specimen in an annotation. The
      developmental_stage_stop slot is optional.
    slots:
      - developmental_stage_start
      - developmental_stage_stop
      - age
      - temporal_qualifiers
      - stage_uberon_slim_terms

  AnatomicalSite:
    is_a: AuditedObject
    description: >-
      The set of terms that define a specific anatomical site within a specimen.
    slots:
      - anatomical_structure
      - anatomical_structure_qualifiers
      - anatomical_structure_uberon_terms
      - anatomical_substructure
      - anatomical_substructure_qualifiers
      - anatomical_substructure_uberon_terms
      - cellular_component
      - cellular_component_qualifiers
    rules:
      - postconditions:
          any_of:
            - slot_conditions:
                anatomical_structure:
                  required: true
            - slot_conditions:
                cellular_component:
                  required: true
          description: At least one of anatomical_structure or cellular_component should be populated.

  ExpressionAnnotationImagePaneAssociation:
    is_a: Association
    description: >-
      An association between an ExpressionAnnotation and an image (in part or
      in full).
    notes: >-
      This aims to provide the same functionality as MGI imagepane.
      Some MODs (like ZFIN) point to the whole image. In these cases,
      the pane would encompass the whole image.
    slot_usage:
      subject:
        range: ExpressionAnnotation
      object:
        range: ImagePane

slots:

  age:
    description: >-
      The age at which an annotated event was observed.
    domain: TemporalContext
    range: string
    multivalued: false

  anatomical_substructure:
    domain: AnatomicalSite
    range: AnatomicalTerm
    multivalued: false

  # ACTION ITEM: Load needed qualifiers as Vocabulary/OntologyTerms.
  # ACTION ITEM: Add FlyBase qualifiers to BSPO; SCRUM-1291 (Sian).
  # ACTION ITEM: Submit FB qualifiers with FBcv curies as OntologyTerms,
  #              leaving out any BSPO terms (Gil).
  anatomical_substructure_qualifiers:
    notes: >-
      See the spatial_qualifier_set enum at the bottom of this file for terms.
    domain: AnatomicalSite
    range: VocabularyTerm
    multivalued: true

  # DQM NOTE: Leave empty instead of submitting Other if no terms apply.
  anatomical_substructure_uberon_terms:
    description: >-
      UBERON slim terms that apply to the anatomical substructure.
    notes: >-
      Allowable terms: UBERON:0001009, UBERON:0005409, UBERON:0000949,
                       UBERON:0001008, UBERON:0002330, UBERON:0002193,
                       UBERON:0002416, UBERON:0002423, UBERON:0002204,
                       UBERON:0001016, UBERON:0000990, UBERON:0001004,
                       UBERON:0001032, UBERON:0005726, UBERON:0007037,
                       UBERON:0002105, UBERON:0002104, UBERON:0000924,
                       UBERON:0000925, UBERON:0000926, UBERON:0003104,
                       UBERON:0001013, UBERON:0000026, UBERON:0016887,
                       UBERON:6005023, UBERON:0002539
      Use of a placeholder term, Other, is no longer required or allowed.
    domain: AnatomicalSite
    range: UBERONTerm
    required: False
    multivalued: true

  anatomical_structure:
    domain: AnatomicalSite
    range: AnatomicalTerm
    multivalued: false

  # ACTION ITEM: Load needed qualifiers as Vocabulary/OntologyTerms.
  anatomical_structure_qualifiers:
    notes: >-
      See the spatial_qualifier_set enum at the bottom of this file for terms.
    domain: AnatomicalSite
    range: VocabularyTerm
    multivalued: true

  # DQM NOTE: Leave empty instead of submitting Other if no terms apply.
  anatomical_structure_uberon_terms:
    description: >-
      UBERON slim terms that apply to the anatomical structure.
    notes: >-
      Allowable terms: UBERON:0001009, UBERON:0005409, UBERON:0000949,
                       UBERON:0001008, UBERON:0002330, UBERON:0002193,
                       UBERON:0002416, UBERON:0002423, UBERON:0002204,
                       UBERON:0001016, UBERON:0000990, UBERON:0001004,
                       UBERON:0001032, UBERON:0005726, UBERON:0007037,
                       UBERON:0002105, UBERON:0002104, UBERON:0000924,
                       UBERON:0000925, UBERON:0000926, UBERON:0003104,
                       UBERON:0001013, UBERON:0000026, UBERON:0016887,
                       UBERON:6005023, UBERON:0002539
      Use of a placeholder term, Other, is no longer required or allowed.
    domain: AnatomicalSite
    range: UBERONTerm
    required: False
    multivalued: true

  assay_used:
    description: >-
      The assay used to experimentally determine gene expression.
    domain: ExpressionAnnotation
    range: MMOTerm

  cellular_component:
    notes: >-
      I would like to restrict the range to GOTerm in cellular_component
      branch, but I'm not sure how to do this.
    domain: AnatomicalSite
    range: GOTerm

  # ACTION ITEM: Load needed qualifiers as Vocabulary/OntologyTerms.
  cellular_component_qualifiers:
    domain: AnatomicalSite
    range: VocabularyTerm
    multivalued: true

  developmental_stage_start:
    description: >-
      The beginning developmental stage at which an annotated event was observed.
    notes: >-
      Currently, we limit this to a single stage, but we could consider allowing
      for stage ranges for a single annotation.
    domain: TemporalContext
    range: StageTerm
    multivalued: false
    required: true

  developmental_stage_stop:
    description: >-
      The end developmental stage at which an annotated event was observed.
      This is not required if the annotation applies to a single stage.
    notes: >-
      Currently, we limit this to a single stage, but we could consider allowing
      for stage ranges for a single annotation.
    domain: TemporalContext
    range: StageTerm
    multivalued: false
    required: false

  entity_assayed:
    description: >-
      The subject of the ExpressionExperiment. This will usually be a Gene, but
      may be a sequence feature, or a placeholder if the exact subject of the
      expression pattern is unknown (e.g., unknown epitope of an antibody).
    domain: ExpressionExperiment
    required: true
    multivalued: false

  expression_annotation_image_associations:
    domain: ExpressionAnnotation
    range: ExpressionAnnotationImagePaneAssociation
    multivalued: true

  expression_annotations:
    description: >-
      The list of ExpressionAnnotations for a given ExpressionExperiment.
    notes: >-
      Listing annotations under a single experiment facilitates data submission.
      However, it opens up the possibility that a single ExpressionAnnotation
      could be incorrectly submitted for many ExpressionExperiments; some
      business logic will be required to flag/prevent such instances.
    domain: ExpressionExperiment
    range: ExpressionAnnotation
    required: true
    multivalued: true

  # FUTURE ACTION ITEM: Load needed qualifiers as Vocabulary/OntologyTerms.
  expression_qualifiers:
    description: >-
      Qualifiers that describe additional characteristics of gene expression.
      For example: faint, intense, restricted.
    notes: >-
      See the expression_qualifier_set enum at the bottom of this file for terms.
    domain: ExpressionAnnotation
    range: VocabularyTerm
    multivalued: true

  detection_reagents:
    description: >-
      Reagents used in the expression assay: e.g., construct, antibodies, probes.
    domain: ExpressionAnnotation
    range: Reagent
    multivalued: true

  specimen_alleles:
    description: >-
      The Allele(s) of the specimen assayed.
    domain: ExpressionExperiment
    range: Allele
    multivalued: true

  specimen_genomic_model:
    description: >-
      The AffectedGenomicModel of the specimen assayed.
    domain: ExpressionExperiment
    range: AffectedGenomicModel
    multivalued: false

  # ACTION ITEM: Load needed qualifiers as Vocabulary/OntologyTerms.
  temporal_qualifiers:
    description: >-
      Qualifiers of the stage or age in an annotation.
    notes: >-
      See the temporal_qualifier_set enum at the bottom of this file for terms.
    domain: TemporalContext
    range: VocabularyTerm
    multivalued: true

  # ACTION ITEM: Create one Vocabulary term for: post embryonic, pre-adult.
  # ACTION ITEM: Make VocabularyTerms that map to the UBERONTerms for now.
  # ACTION ITEM: Ask UBERON to make the missing term (and wait).
  stage_uberon_slim_terms:
    description: >-
      The high-level UBERON slim terms that apply to the developmental range
      of the TemporalContext component of an ExpressionPattern. The following
      UBERON terms are allowed: UBERON:0000068, UBERON:0000113. A non-UBERON
      term is also allowed: post embryonic, pre-adult.
    notes: >-
      FMS submission allowed for a string due to absence of appropriate UBERON
      term. This term must, for example, cover Drosophila larval and pupal
      stages (there are UBERON terms for each, but not a single term spanning
      both developmental phases).
    domain: TemporalContext
    range: VocabularyTerm
    multivalued: true

  when_expressed:
    description: >-
      When some entity is observed to be present in a specimen. If no temporal
      information is available for an annotation, use a root stage term for the
      developmental_stage_start.
    domain: ExpressionPattern
    range: TemporalContext
    multivalued: false
    required: true

  when_expressed_stage_name:
    description: >-
      A human-readable stage name. To be used when an ontology term for the
      relevant stage is not available.
    notes: >-
      Corresponds to whenExpressed.stageName in frozen JSON schema.
    domain: ExpressionAnnotation
    range: string
    required: false
    multivalued: false

  where_expressed:
    description: >-
      Where some entity is observed to be present in a specimen. If no spatial
      information is available for an annotation, use a root anatomical term
      for the anatomical_structure.
    domain: ExpressionPattern
    range: AnatomicalSite
    multivalued: false
    required: true

  where_expressed_statement:
    description: >-
      A human-readable free-text description of the anatomical location of the
      expression pattern.
    notes: >-
      Corresponds to whereExpressedStatement in frozen JSON schema.
    domain: ExpressionAnnotation
    range: string
    required: true
    multivalued: false

enums:

  spatial_qualifier_set:
    notes: >-
      We need to get a set of relevant qualifiers used across the MODs.
      We may prefer to use ontology terms instead of an enum here.
      Filled in with a small sample of FB qualifiers for now.
      Seems like MGI has similar terms
      ZFIN does this.
    permissible_values:
      anterior:
      anterior_posterior_gradient:
      apical:
      basal:
      central:
      distal:
      dorsal:
      dorso-lateral:
      egg_length:
      gap_expression_pattern:
      pair_rule_expression_pattern:
      segment_polarity_expression_pattern:
      terminal_expression_pattern:
      gradient:

  expression_qualifier_set:
    notes: >-
      We need to get a set of relevant qualifiers used across the MODs.
      Filled in with FB qualifiers for now.
    permissible_values:
      strong:
      moderate:
      faint:
      endogenous:
      granular:
      intense:
      punctate:
      uniform:
      non-uniform:
      variable:
      clusters:
      diffuse:
      graded:
      not_specified:
      patchy:
      regionally_restricted:
      scattered:
      single_cells:
      spotted:
      ubiquitous:
      widespread:

  temporal_qualifier_set:
    notes: >-
      We need to get a set of relevant qualifiers used across the MODs.
      Filled in with a FB qualifier for now. MGI, WB, ZFIN don't use this.
    permissible_values:
      throughout:
        description: >-
          An event that happens from start to end times included in the annotation
      sometime_during:
        description: >-
          An event that happens during some of the stages included in the annotation, but maybe not all
