id: https://github.com/alliance-genome/agr_curation_schema/balancer
name: alliance-schema-balancer
title: Alliance Schema Balancer Extension
description: >-
  LinkML schema extension for balancer chromosome support in the
  Alliance of Genome Resources (AGR) schema. This extension implements
  separate BalancerChromosome class per Round 6 o3 architectural guidance.
  Uses structured approach with P1-P3 critical fixes applied.

version: 1.3.0
default_prefix: alliance
default_range: string

imports:
  - core
  - allele
  - linkml:types

prefixes:
  alliance: https://github.com/alliance-genome/agr_curation_schema/
  linkml: https://w3id.org/linkml/
  SO: http://purl.obolibrary.org/obo/SO_
  GENO: http://purl.obolibrary.org/obo/GENO_
  PATO: http://purl.obolibrary.org/obo/PATO_
  biolink: https://w3id.org/biolink/vocab/

# P1-P3 CRITICAL FIXES APPLIED FROM ROUND 6

slots:
  # BalancerChromosome specific slots
  represents_allele:
    domain: BalancerChromosome
    range: uriorcurie
    description: >-
      Back-pointer to the canonical Allele entity (if one exists).
      Maintains compatibility with existing AGR ETL while keeping
      semantics clean per o3 architectural guidance.
    multivalued: false
    required: false
    examples:
      - value: "FB:FBal0016059"
        description: "TM6B allele represented by this balancer chromosome"

  chromosome:
    domain: BalancerChromosome
    range: uriorcurie
    description: >-
      Points to core Chromosome entity that this balancer affects.
      Essential for biological context and validation.
    multivalued: false
    required: true
    examples:
      - value: "FB:FBch0003081"
        description: "Chromosome 3 for TM6B balancer"

  has_breakpoints:
    domain: BalancerChromosome
    range: Breakpoint
    multivalued: true
    description: >-
      Collection of structured chromosomal breakpoints defining this 
      balancer's rearrangement pattern. Implements P3 fix from Round 6.
    required: false
    examples:
      - value: "FB:FBal0016059_brk1"
        description: "First breakpoint of TM6B balancer"

  suppressed_regions:
    domain: BalancerChromosome
    range: SuppressedRegion
    multivalued: true
    description: >-
      Regions where recombination is suppressed by this balancer.
      Many balancers only suppress distal regions, not entire arms.
    required: false
    examples:
      - value: "FB:FBal0016059_supp1"
        description: "Distal suppression region of TM6B"

  # P4 - Critical missing biological concept
  homozygous_viability:
    domain: BalancerChromosome
    range: ViabilityEnum
    description: >-
      Viability of homozygous individuals. Essential for stock centers
      and genetic planning. P4 fix from Round 6 consultation.
    required: false
    default: UNKNOWN
    examples:
      - value: "LETHAL"
        description: "TM6B is lethal when homozygous"

  viability_condition:
    domain: BalancerChromosome
    range: string
    description: >-
      Conditions for conditional viability (temperature, stage, etc.)
    required: false
    examples:
      - value: "lethal at 25°C, viable at 18°C"
        description: "Temperature-sensitive viability condition"

  # P2 CRITICAL FIX - Replace boolean with enum
  balancer_status:
    domain: BalancerChromosome
    range: BalancerStatus
    description: >-
      Balancer classification status with provenance capability.
      Replaces boolean is_balancer per P2 Round 6 fix.
    required: false
    default: UNKNOWN
    examples:
      - value: "BALANCER"
        description: "TM6B is confirmed balancer chromosome"

  # Breakpoint specific slots  
  cytological_band:
    domain: Breakpoint
    range: string
    description: >-
      Cytological band location using standard Drosophila nomenclature.
      Structured approach enables proper validation.
    pattern: "^[0-9XY]+[LR]?:[0-9]+[A-Z](?:\\.[0-9]+)?$"
    examples:
      - value: "3L:61A1"
        description: "Cytological location of TM6B breakpoint"

  orientation:
    domain: Breakpoint
    range: OrientationEnum
    description: >-
      Chromosomal orientation at this breakpoint. Critical for
      inversion modeling per P3 Round 6 guidance.
    required: false
    default: UNKNOWN
    examples:
      - value: "REVERSE"
        description: "Inverted orientation at breakpoint"

  breakpoint_type:
    domain: Breakpoint
    range: BreakpointTypeEnum
    description: >-
      Type of chromosomal rearrangement at this breakpoint.
      Uses correct SO terms per Round 6 consultation.
    required: false
    examples:
      - value: "INVERSION"
        description: "Chromosomal inversion breakpoint"

  # SuppressedRegion specific slots
  cytological_location:
    domain: SuppressedRegion
    range: string
    description: >-
      Cytological range where recombination is suppressed.
      Pattern fixed per o3 technical recommendations.
    pattern: "^[0-9XY]+[LR]?:[0-9]+[A-Z](?:\\.[0-9]+)?-[0-9]+[A-Z](?:\\.[0-9]+)?$"
    required: false
    examples:
      - value: "3L:61A1-84F3"
        description: "Suppressed region on chromosome 3L"

  suppression_efficiency:
    domain: SuppressedRegion
    range: SuppressionEnum
    description: >-
      Efficiency of recombination suppression in this region.
      Captures biological variability in suppression strength.
    required: false
    examples:
      - value: "COMPLETE"
        description: "100% recombination suppression"

  # Legacy compatibility slots for flat approach
  carried_alleles:
    domain: BalancerChromosome
    range: uriorcurie
    description: >-
      Marker alleles carried by this balancer chromosome for
      genetic selection purposes. Uses uriorcurie to prevent recursion.
    multivalued: true
    required: false
    examples:
      - value: "FB:FBal0000583"
        description: "AntpHu allele carried by TM6B balancer"

  balancer_utility:
    domain: BalancerChromosome
    range: BalancerUtilityEnum
    description: >-
      Primary genetic utility of this balancer chromosome.
    multivalued: false
    required: false
    examples:
      - value: "suppressor_of_crossing_over"
        description: "TM6B suppresses recombination"

# P1 CRITICAL FIX - Proper ID patterns using AGR best practices
classes:
  BalancerChromosome:
    is_a: GenomicEntity
    description: >-
      Chromosomal balancer entity separate from Allele per o3 Option B.
      Avoids semantic overload and AGR QC failures. Represents 
      chromosome-level rearrangements with structured biological modeling.
    slots:
      - id
      - represents_allele
      - chromosome
      - has_breakpoints
      - suppressed_regions
      - homozygous_viability
      - viability_condition
      - balancer_status
      - carried_alleles
      - balancer_utility
    slot_usage:
      id:
        identifier: true
        id_prefixes: [FB]
        pattern: "^FBal[0-9]{8}$"  # P1 fix - pattern on local_id only
        required: true
    examples:
      - value: "FB:FBal0016059"
        description: "TM6B balancer chromosome with structured modeling"

  Breakpoint:
    is_a: InformationContentEntity  # Not NamedThing per o3 guidance
    description: >-
      Chromosomal breakpoint with structured coordinates and biological context.
      Enables precise modeling of inversion boundaries and orientations.
    slots:
      - id
      - chromosome
      - cytological_band
      - orientation
      - breakpoint_type
    slot_usage:
      id:
        identifier: true
        id_prefixes: [FB]
        pattern: "^FBal[0-9]{8}_brk[0-9]+$"  # P1 fix
        required: true
      chromosome:
        range: uriorcurie
        required: true
    examples:
      - value: "FB:FBal0016059_brk1"
        description: "First breakpoint of TM6B inversion complex"

  SuppressedRegion:
    is_a: InformationContentEntity  # Not NamedThing per o3 guidance  
    description: >-
      Genomic region where recombination is suppressed by balancer.
      Captures regional variation in suppression efficiency.
    slots:
      - id
      - cytological_location
      - suppression_efficiency
    slot_usage:
      id:
        identifier: true
        id_prefixes: [FB]
        pattern: "^FBal[0-9]{8}_supp[0-9]+$"  # P1 fix
        required: true
    examples:
      - value: "FB:FBal0016059_supp1"
        description: "Primary suppression region of TM6B"

# P2 CRITICAL FIX - Boolean → Enum transformation
enums:
  BalancerStatus:
    description: >-
      Balancer classification status with reasoning capability.
      Replaces dead-end boolean per Round 6 P2 fix.
    permissible_values:
      BALANCER:
        description: "Confirmed balancer chromosome"
        meaning: "GENO:0000002"  # balancer_allele
      NOT_BALANCER:
        description: "Confirmed non-balancer"
      UNKNOWN:
        description: "Status not determined"

  # P3 - Structured breakpoint enums with correct SO terms
  OrientationEnum:
    description: >-
      Chromosomal orientation at breakpoint. Essential for inversion modeling.
    permissible_values:
      FORWARD:
        description: "Normal chromosomal orientation"
        meaning: "SO:0001879"  # chromosomal_inversion_breakpoint
      REVERSE:
        description: "Inverted chromosomal orientation"  
        meaning: "SO:0001879"  # chromosomal_inversion_breakpoint
      UNKNOWN:
        description: "Orientation not determined"

  BreakpointTypeEnum:
    description: >-
      Type of chromosomal rearrangement. Uses correct SO terms per Round 6.
    permissible_values:
      INVERSION:
        description: "Chromosomal inversion breakpoint"
        meaning: "SO:0001879"  # chromosomal_inversion_breakpoint
      DELETION:
        description: "Chromosomal deletion breakpoint"
        meaning: "SO:0000159"  # deletion
      DUPLICATION:
        description: "Chromosomal duplication breakpoint"
        meaning: "SO:1000035"  # duplication
      TRANSLOCATION:
        description: "Chromosomal translocation breakpoint"
        meaning: "SO:0000199"  # translocation

  # P4 - Critical missing biological concept
  ViabilityEnum:
    description: >-
      Homozygous viability status. Essential for stock centers per Round 6.
    permissible_values:
      LETHAL:
        description: "Lethal when homozygous"
        meaning: "PATO:0000718"  # lethal
      VIABLE:
        description: "Viable when homozygous"
        meaning: "PATO:0000169"  # viable
      STERILE:
        description: "Sterile when homozygous"
        meaning: "PATO:0000618"  # sterile
      CONDITIONAL:
        description: "Conditionally lethal/sterile"
        meaning: "PATO:0000718"  # lethal (conditional)

  SuppressionEnum:
    description: >-
      Recombination suppression efficiency. Captures biological variability.
    permissible_values:
      COMPLETE:
        description: "100% recombination suppression"
      PARTIAL:
        description: "Partial recombination suppression"
      VARIABLE:
        description: "Variable suppression efficiency"

  BalancerUtilityEnum:
    description: >-
      Primary genetic utility of balancer chromosomes.
    permissible_values:
      suppressor_of_crossing_over:
        description: >-
          Suppresses recombination in balanced chromosomal region.
        meaning: "SO:0001059"  # chromosomal_inversion
      lethal_when_homozygous:
        description: >-
          Lethal in homozygous condition, maintains heterozygous state.
        meaning: "SO:0001773"  # lethal_variant
      visible_marker_carrier:
        description: >-
          Carries visible phenotypic markers for identification.
        meaning: "SO:0001060"  # sequence_variant
      multiple_inversion_complex:
        description: >-
          Contains multiple chromosomal inversions.
        meaning: "SO:1000037"  # inversion_breakpoint