id: https://github.com/alliance-genome/agr_curation_schema/balancer
name: alliance-schema-balancer
title: Alliance Schema Balancer Extension
description: >-
  LinkML schema extension for balancer chromosome support in the
  Alliance of Genome Resources (AGR) schema. This extension implements
  advanced structured modeling with BalancerChromosome class per Round 6
  o3 architectural guidance. Includes sophisticated biological modeling
  with P1-P3 critical fixes applied.

version: 2.1.0
default_prefix: alliance
default_range: string

imports:
  - core
  - allele
  - linkml:types

prefixes:
  alliance: https://github.com/alliance-genome/agr_curation_schema/
  linkml: https://w3id.org/linkml/
  SO: http://purl.obolibrary.org/obo/SO_
  GENO: http://purl.obolibrary.org/obo/GENO_
  PATO: http://purl.obolibrary.org/obo/PATO_
  biolink: https://w3id.org/biolink/vocab/

# P1-P3 CRITICAL FIXES + ADVANCED STRUCTURED MODELING

slots:
  # BalancerChromosome core slots  
  represents_allele:
    domain: BalancerChromosome
    range: uriorcurie
    description: >-
      Back-pointer to canonical Allele entity. Maintains AGR ETL compatibility
      while preserving clean chromosome-level semantics per o3 guidance.
    multivalued: false
    required: false
    examples:
      - value: "FB:FBal0016059"
        description: "TM6B allele represented by this balancer chromosome"

  chromosome:
    domain: BalancerChromosome
    range: uriorcurie
    description: >-
      Core Chromosome entity affected by this balancer. Essential for
      biological context and cross-validation with AGR chromosome data.
    multivalued: false
    required: true
    examples:
      - value: "FB:FBch0003081"
        description: "Chromosome 3 for TM6B balancer"

  has_breakpoints:
    domain: BalancerChromosome
    range: Breakpoint
    multivalued: true
    description: >-
      Structured chromosomal breakpoints with coordinates, orientation,
      and rearrangement type. Enables sophisticated computational analysis.
    required: false
    examples:
      - value: "FB:FBal0016059_brk1"
        description: "First breakpoint of TM6B inversion complex"

  suppressed_regions:
    domain: BalancerChromosome
    range: SuppressedRegion  
    multivalued: true
    description: >-
      Genomic regions with recombination suppression. Many balancers only
      suppress distal regions, captured through structured modeling.
    required: false
    examples:
      - value: "FB:FBal0016059_supp1"
        description: "Distal suppression region on 3L arm"

  parent_stock_relationships:
    domain: BalancerChromosome
    range: StockRelationship
    multivalued: true
    description: >-
      Structured genetic relationships to parent stocks and aberrations.
      Captures construction history and lineage provenance.
    required: false
    examples:
      - value: "FB:FBal0016059_rel1"
        description: "TM6B derivation from In(3LR)TM6B aberration"

  suppresses_genes:
    domain: BalancerChromosome
    range: uriorcurie
    multivalued: true
    description: >-
      Genes whose recombination is suppressed. Enables computational
      querying across genomic regions and pathway analysis.
    required: false
    examples:
      - value: "FB:FBgn0003118"
        description: "scabrous gene in suppressed region"

  # P4 - Critical missing biological concepts
  homozygous_viability:
    domain: BalancerChromosome
    range: ViabilityEnum
    description: >-
      Viability when homozygous. Essential for stock centers and breeding
      programs. Major gap identified in Round 6 consultation.
    required: false
    default: UNKNOWN
    examples:
      - value: "LETHAL"
        description: "TM6B is lethal when homozygous"

  viability_condition:
    domain: BalancerChromosome
    range: string
    description: >-
      Environmental conditions affecting viability (temperature, stage).
    required: false
    examples:
      - value: "lethal at 25°C, semi-viable at 18°C"
        description: "Temperature-dependent conditional lethality"

  phenotypic_markers:
    domain: BalancerChromosome
    range: uriorcurie
    multivalued: true
    description: >-
      Dominant phenotypic markers for genetic tracking. Critical gap
      identified by o3 - essential for stock center operations.
    required: false
    examples:
      - value: "FB:FBal0000583"  
        description: "AntpHu (Antennapedia Humeral) dominant marker"

  # P2 CRITICAL FIX - Replace boolean with enum
  balancer_status:
    domain: BalancerChromosome
    range: BalancerStatus
    description: >-
      Balancer classification with provenance capability. Replaces 
      dead-end boolean per Round 6 P2 critical fix.
    required: false
    default: UNKNOWN
    examples:
      - value: "BALANCER"
        description: "TM6B confirmed as balancer chromosome"

  # Breakpoint structured slots (P3 fix)
  cytological_band:
    domain: Breakpoint
    range: string
    description: >-
      Cytological band location with improved pattern validation.
      Fixed regex per o3 technical recommendations.
    pattern: "^[0-9XY]+[LR]?:[0-9]+[A-Z](?:\\.[0-9]+)?$"
    required: false
    examples:
      - value: "3L:61A1"
        description: "First TM6B breakpoint location"

  sequence_start:
    domain: Breakpoint
    range: integer
    description: >-
      Sequence coordinate start position. Enables integration with
      modern genome assemblies (Nanopore data available for some balancers).
    required: false
    examples:
      - value: 12650000
        description: "Approximate sequence position for 61A1"

  sequence_end:
    domain: Breakpoint
    range: integer
    description: >-
      Sequence coordinate end position for breakpoint region.
    required: false
    examples:
      - value: 12655000
        description: "Breakpoint region end coordinate"

  reference_genome:
    domain: Breakpoint
    range: string
    description: >-
      Reference genome assembly identifier for coordinates.
    required: false
    examples:
      - value: "dm6"
        description: "Drosophila melanogaster release 6 assembly"

  orientation:
    domain: Breakpoint
    range: OrientationEnum
    description: >-
      Chromosomal orientation at breakpoint. Critical for inversion
      modeling per Round 6 P3 guidance.
    required: false
    default: UNKNOWN
    examples:
      - value: "REVERSE"
        description: "Inverted orientation at TM6B breakpoint"

  breakpoint_type:
    domain: Breakpoint
    range: BreakpointTypeEnum
    description: >-
      Rearrangement type with correct SO term mappings per Round 6.
    required: false
    examples:
      - value: "INVERSION"
        description: "Chromosomal inversion breakpoint"

  # SuppressedRegion structured slots
  cytological_location:
    domain: SuppressedRegion
    range: string
    description: >-
      Cytological range of suppression. Pattern improved per o3 guidance.
    pattern: "^[0-9XY]+[LR]?:[0-9]+[A-Z](?:\\.[0-9]+)?-[0-9]+[A-Z](?:\\.[0-9]+)?$"
    required: false
    examples:
      - value: "3L:61A1-84F3"
        description: "Suppressed region spanning chromosome 3L arm"

  sequence_location:
    domain: SuppressedRegion
    range: string
    description: >-
      Sequence coordinates for suppressed region. Supports modern genomics.
    pattern: "^[0-9XY]+[LR]?:[0-9]+-[0-9]+$"
    required: false
    examples:
      - value: "3L:12650000-28750000"
        description: "Sequence coordinates for suppressed region"

  suppression_efficiency:
    domain: SuppressedRegion
    range: SuppressionEnum
    description: >-
      Recombination suppression efficiency. Captures biological variability.
    required: false
    examples:
      - value: "COMPLETE"
        description: "100% suppression in TM6B inversion region"

  # StockRelationship structured slots
  parent_stock_id:
    domain: StockRelationship
    range: uriorcurie
    description: >-
      Identifier of parent stock or chromosomal aberration.
    required: true
    examples:
      - value: "FB:FBab0005465"
        description: "In(3LR)TM6B parent aberration"

  relationship_type:
    domain: StockRelationship
    range: RelationshipTypeEnum
    description: >-
      Nature of genetic relationship to parent stock.
    required: false
    examples:
      - value: "derived_from_aberration"
        description: "Balancer derived from chromosomal aberration"

  construction_method:
    domain: StockRelationship
    range: string
    description: >-
      Method used to construct balancer from parent stock.
    required: false
    examples:
      - value: "multiple_inversion_selection"
        description: "Selection of multiple inversion complex"

  # Legacy compatibility
  carried_alleles:
    domain: BalancerChromosome
    range: uriorcurie
    multivalued: true
    description: >-
      Marker alleles for genetic selection. Uses uriorcurie to prevent recursion.
    required: false
    examples:
      - value: "FB:FBal0000583"
        description: "AntpHu marker allele"

  balancer_utility:
    domain: BalancerChromosome
    range: BalancerUtilityEnum
    description: >-
      Primary genetic utility classification.
    required: false
    examples:
      - value: "suppressor_of_crossing_over"
        description: "TM6B primary utility"

# P1 CRITICAL FIX - Proper ID patterns using AGR best practices
classes:
  BalancerChromosome:
    is_a: GenomicEntity
    description: >-
      Advanced balancer chromosome entity implementing o3 Option B architecture.
      Separate from Allele to avoid semantic overload and AGR QC failures.
      Supports sophisticated biological modeling and computational genomics.
    slots:
      - id
      - represents_allele
      - chromosome
      - has_breakpoints
      - suppressed_regions
      - parent_stock_relationships
      - suppresses_genes
      - homozygous_viability
      - viability_condition
      - phenotypic_markers
      - balancer_status
      - carried_alleles
      - balancer_utility
    slot_usage:
      id:
        identifier: true
        id_prefixes: [FB]
        pattern: "^FBal[0-9]{8}$"  # P1 fix - local pattern only
        required: true
    examples:
      - value: "FB:FBal0016059"
        description: "TM6B balancer with advanced structured modeling"

  Breakpoint:
    is_a: InformationContentEntity  # Not NamedThing per o3 guidance
    description: >-
      Sophisticated breakpoint modeling with sequence and cytological coordinates.
      Supports both legacy cytological data and modern genomic assemblies.
    slots:
      - id
      - chromosome
      - cytological_band
      - sequence_start
      - sequence_end
      - reference_genome
      - orientation
      - breakpoint_type
    slot_usage:
      id:
        identifier: true
        id_prefixes: [FB]
        pattern: "^FBal[0-9]{8}_brk[0-9]+$"  # P1 fix
        required: true
      chromosome:
        range: uriorcurie
        required: true
    examples:
      - value: "FB:FBal0016059_brk1"
        description: "TM6B first inversion breakpoint with dual coordinates"

  SuppressedRegion:
    is_a: InformationContentEntity  # Not NamedThing per o3 guidance
    description: >-
      Genomic region with quantified recombination suppression. Captures
      regional variation and efficiency gradients across chromosome arms.
    slots:
      - id
      - cytological_location
      - sequence_location
      - suppression_efficiency
    slot_usage:
      id:
        identifier: true
        id_prefixes: [FB]
        pattern: "^FBal[0-9]{8}_supp[0-9]+$"  # P1 fix
        required: true
    examples:
      - value: "FB:FBal0016059_supp1"
        description: "Primary suppression region with efficiency measurement"

  StockRelationship:
    is_a: InformationContentEntity  # Not NamedThing per o3 guidance
    description: >-
      Genetic relationship capturing balancer construction lineage and
      derivation history from parent stocks and aberrations.
    slots:
      - id
      - parent_stock_id
      - relationship_type
      - construction_method
    slot_usage:
      id:
        identifier: true
        id_prefixes: [FB]
        pattern: "^FBal[0-9]{8}_rel[0-9]+$"  # P1 fix
        required: true
    examples:
      - value: "FB:FBal0016059_rel1"
        description: "TM6B derivation relationship to parent aberration"

# P2 CRITICAL FIX - Boolean → Enum with reasoning capability
enums:
  BalancerStatus:
    description: >-
      Balancer classification status enabling provenance and reasoning.
      Replaces dead-end boolean per Round 6 P2 fix.
    permissible_values:
      BALANCER:
        description: "Confirmed balancer chromosome"
        meaning: "GENO:0000002"  # balancer_allele
      NOT_BALANCER:
        description: "Confirmed non-balancer"
      UNKNOWN:
        description: "Classification status not determined"

  # P3 - Structured breakpoint enums with correct SO terms
  OrientationEnum:
    description: >-
      Chromosomal orientation enabling inversion modeling. Essential per Round 6.
    permissible_values:
      FORWARD:
        description: "Normal chromosomal orientation"
        meaning: "SO:0001879"  # chromosomal_inversion_breakpoint
      REVERSE:
        description: "Inverted chromosomal orientation"
        meaning: "SO:0001879"  # chromosomal_inversion_breakpoint
      UNKNOWN:
        description: "Orientation not determined"

  BreakpointTypeEnum:
    description: >-
      Chromosomal rearrangement types with correct SO mappings per Round 6.
    permissible_values:
      INVERSION:
        description: "Chromosomal inversion breakpoint"
        meaning: "SO:0001879"  # chromosomal_inversion_breakpoint
      DELETION:
        description: "Chromosomal deletion breakpoint"
        meaning: "SO:0000159"  # deletion
      DUPLICATION:
        description: "Chromosomal duplication breakpoint"
        meaning: "SO:1000035"  # duplication
      TRANSLOCATION:
        description: "Chromosomal translocation breakpoint"
        meaning: "SO:0000199"  # translocation

  # P4 - Critical missing biological concepts
  ViabilityEnum:
    description: >-
      Homozygous viability classification. Essential for stock centers per Round 6.
    permissible_values:
      LETHAL:
        description: "Lethal when homozygous"
        meaning: "PATO:0000718"  # lethal
      VIABLE:
        description: "Viable when homozygous"
        meaning: "PATO:0000169"  # viable
      STERILE:
        description: "Sterile when homozygous"
        meaning: "PATO:0000618"  # sterile
      CONDITIONAL:
        description: "Conditionally lethal/sterile"
        meaning: "PATO:0000718"  # lethal (conditional)

  SuppressionEnum:
    description: >-
      Recombination suppression efficiency capturing biological variability.
    permissible_values:
      COMPLETE:
        description: "100% recombination suppression"
      PARTIAL:
        description: "Partial recombination suppression (50-90%)"
      VARIABLE:
        description: "Variable suppression efficiency (environment dependent)"
      MINIMAL:
        description: "Minimal suppression (<50%)"

  RelationshipTypeEnum:
    description: >-
      Types of genetic relationships to parent stocks and aberrations.
    permissible_values:
      derived_from_aberration:
        description: "Derived from chromosomal aberration"
      selected_from_stock:
        description: "Selected from existing stock"
      constructed_from_cross:
        description: "Constructed from genetic cross"
      isolated_from_population:
        description: "Isolated from wild population"

  BalancerUtilityEnum:
    description: >-
      Primary genetic utilities with ontology mappings.
    permissible_values:
      suppressor_of_crossing_over:
        description: >-
          Suppresses recombination maintaining linkage relationships.
        meaning: "SO:0001059"  # chromosomal_inversion
      lethal_when_homozygous:
        description: >-
          Lethal in homozygous state maintaining heterozygosity.
        meaning: "SO:0001773"  # lethal_variant
      visible_marker_carrier:
        description: >-
          Carries visible phenotypic markers for identification.
        meaning: "SO:0001060"  # sequence_variant
      multiple_inversion_complex:
        description: >-
          Contains multiple inversions forming complex rearrangement.
        meaning: "SO:1000037"  # inversion_breakpoint